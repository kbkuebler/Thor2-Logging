# rsyslog.conf

module(load="imtcp")           # TCP input
module(load="omhttp")          # Loki output
input(type="imtcp" port="5514")

# Template for Loki JSON format
template(name="LokiFormat" type="list") {
  constant(value="{\"streams\": [{\"stream\": {")
    constant(value="\"job\":\"hammerspace\"")
  constant(value="}, \"values\": [[\"")
    property(name="timereported" dateFormat="unixtimestamp" format="json")
    constant(value="000000\", \"")
    property(name="rawmsg" format="json")
    constant(value="\"]]}]}")
}

# Send everything to Loki
action(
  type="omhttp"
  server="http://loki:3100"         # Update if your Loki container is named differently
  restpath="/loki/api/v1/push"
  template="LokiFormat"
  action.resumeRetryCount="-1"     # Infinite retries
  queue.type="linkedList"
  queue.size="10000"
)
